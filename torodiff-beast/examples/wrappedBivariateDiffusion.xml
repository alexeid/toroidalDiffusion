<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.pkgmgmt:beast.base.core:beast.base.inference:beast.base.evolution.alignment:beast.base.evolution.tree.coalescent:beast.base.util:beast.base.math:beast.evolution.nuc:beast.base.evolution.operator:beast.base.inference.operator:beast.base.evolution.sitemodel:beast.base.evolution.substitutionmodel:beast.base.evolution.likelihood:beast.base.evolution.speciation" required="BEAST v2.5.0" version="2.5">

    <!-- minordimension = nsite * 2 (angles) -->
    <parameter id="dihedralAngles" keys="8 7 9 1 2 5 6 0 3 4"
               minordimension="20"
               value="2.69	2.92	2.922	2.828	3.116	2.583	3.116	2.829	3.229	2.649	2.905	3.36	2.735	3.087	2.978	2.512	2.905	2.748	2.592	3.392
                      2.796	2.407	2.697	2.759	2.749	2.361	2.6	3.039	3.215	3.078	2.823	3.148	2.903	2.772	2.357	3.034	2.582	2.86	2.937	3.046
                      2.912	2.506	3.034	2.627	3.123	2.476	2.817	2.98	2.829	3.467	2.782	3.165	2.969	2.881	2.547	2.615	2.664	2.786	2.565	3.402
                      2.883	2.499	2.878	2.6  3.115	2.5	2.718	3.008	2.818	3.388	2.7	3.104	2.954	2.805	2.569	2.687	2.826	2.732	2.608	3.298
                      2.765	2.723	3.002	3.198	2.807	2.411	2.65	2.696	3.237	3.065	2.905	3.058	2.762	2.823	2.663	2.561	2.437	3.14	2.829	2.99
                      2.861	2.746	2.966	3.197	3.027	2.443	2.658	2.728	3.283	3.038	2.968	2.916	2.861	2.904	2.836	2.635	2.514	3.296	2.881	3.135
                      2.794	2.748	2.941	3.159	3.001	2.482	2.698	2.724	3.321	3.012	2.942	2.897	2.813	2.805	2.783	2.656	2.472	3.227	2.921	3.168
                      2.995	2.893	2.848	2.773	3.102	2.86	2.758	2.796	3.081	2.833	2.814	3.318	2.53	2.461	2.457	2.936	2.886	3.156	3.222	2.822
                      3.04	2.897	2.933	2.773	3.107	2.828	2.723	2.775	3.145	2.81	2.826	3.47	2.636	2.178	2.562	2.778	2.836	3.149	3.054	2.714
                      2.955	2.843	2.968	3.086	3.151	2.828	2.646	2.682	3.172	2.74	2.796	3.583	2.541	2.27	2.474	2.881	2.817	3.061	3.223	3.028"/>
<!-- TODO keys?   -->
    <parameter id="internalNodesAngles"
               minordimension="20"
               value="2.883	2.499	2.878	2.6	3.115	2.5	2.718	3.008	2.818	3.388	2.7	3.104	2.954	2.805	2.569	2.687	2.826	2.732	2.608	3.298
                      2.899	2.512	2.947	2.621	3.098	2.525	2.734	2.968	2.871	3.445	2.755	3.103	2.958	2.793	2.626	2.685	2.815	2.742	2.667	3.337
                      2.794	2.748	2.941	3.159	3.001	2.482	2.698	2.724	3.321	3.012	2.942	2.897	2.813	2.805	2.783	2.656	2.472	3.227	2.921	3.168
                      2.783	2.74	2.945	3.158	2.997	2.456	2.664	2.712	3.312	3.061	2.923	2.87	2.913	2.808	2.806	2.669	2.443	3.182	2.875	3.133
                      2.955	2.843	2.968	3.086	3.151	2.828	2.646	2.682	3.172	2.74	2.796	3.583	2.541	2.27	2.474	2.881	2.817	3.061	3.223	3.028
                      3.051	2.897	2.966	2.87	3.115	2.845	2.718	2.796	3.179	2.872	2.819	3.364	2.573	2.35	2.552	2.94	2.846	3.135	3.132	2.784
                      3.055	2.908	2.946	2.872	3.121	2.859	2.727	2.78	3.195	2.859	2.822	3.341	2.602	2.337	2.537	2.961	2.832	3.126	3.156	2.763
                      2.853	2.84	3.097	2.978	3.0	2.814	2.741	2.961	3.16	3.029	2.91	3.181	2.839	2.79	2.671	2.995	2.765	3.129	3.101	3.119
                      2.921	2.777	3.023	2.873	2.956	2.801	2.872	2.987	3.115	2.965	2.943	3.127	2.841	2.687	2.823	3.13	2.651	3.079	3.036	3.118"/>


    <run id="mcmc" spec="MCMC" chainLength="1000000">
        <state id="state" storeEvery="10000">
            <parameter id="lambda" spec="parameter.RealParameter" name="stateNode">31.938590842525898</parameter>
<!-- TODO lower="0.0" upper="2pi" -->
            <parameter id="mu" spec="parameter.RealParameter" dimension="2" name="stateNode">2.0 2.5</parameter>
            <parameter id="sigma" spec="parameter.RealParameter" dimension="2" name="stateNode">0.5 0.75</parameter>
            <parameter id="alpha" spec="parameter.RealParameter" dimension="3" name="stateNode">1.0 1.0 0.5</parameter>

        </state>

        <!-- START posterior -->
        <distribution id="posterior" spec="beast.base.inference.CompoundDistribution">

            <!-- START prior -->
            <distribution id="prior" spec="beast.base.inference.CompoundDistribution">

                <distribution id="lambda.prior" spec="distribution.Prior" x="@lambda">
                    <distr id="lambda.LogNormalDistributionModel" spec="distribution.LogNormalDistributionModel">
                        <parameter id="RealParameter" spec="parameter.RealParameter" name="M">3.0</parameter>
                        <parameter id="RealParameter1" spec="parameter.RealParameter" name="S">1.0</parameter>
                    </distr>
                </distribution>

                <!-- Prior for mu -->
                <distribution id="mu.prior" spec="distribution.Prior" x="@mu">
                    <distr id="mu.NormalDistributionModel" spec="distribution.Normal">
                        <parameter id="mu.mean" spec="parameter.RealParameter" name="mean">-1.0</parameter>
                        <parameter id="mu.sd" spec="parameter.RealParameter" name="sigma">1.0</parameter>
                    </distr>
                </distribution>

                <!-- Prior for alpha -->
                <distribution id="alpha.prior" spec="distribution.Prior" x="@alpha">
                    <distr id="alpha.LogNormalDistributionModel" spec="distribution.LogNormalDistributionModel">
                        <parameter id="alpha.meanlog" spec="parameter.RealParameter" name="M">0.0</parameter>
                        <parameter id="alpha.sdlog" spec="parameter.RealParameter" name="S">0.25</parameter>
                    </distr>
                </distribution>

                <!-- Prior for sigma -->
                <distribution id="sigma.prior" spec="distribution.Prior" x="@sigma">
                    <distr id="BetaDistributionModel" spec="distribution.Beta">
                        <parameter id="sigma.alpha" spec="parameter.RealParameter" name="alpha">0.5</parameter>
                        <parameter id="sigma.beta" spec="parameter.RealParameter" name="beta">1</parameter>
                    </distr>
                </distribution>

            </distribution>
            <!-- END prior -->

            <!-- START likelihood -->
            <distribution id="likelihood" spec="beast.base.inference.CompoundDistribution" useThreads="false">

                <distribution id="DA.treeLikelihood" spec="toroidaldiffusion.evolution.likelihood.PhyloWrappedBivariateDiffusion">
                    <daTreeModel id="daTreeModel" spec="toroidaldiffusion.evolution.tree.DihedralAngleTreeModel">
                        <tipValues idref="dihedralAngles"/>
                        <internalNodesValues idref="internalNodesAngles"/>

                        <tree id="psi" spec="beast.base.evolution.tree.TreeParser" IsLabelledNewick="true"
                              adjustTipHeights="false"  offset="0" singlechild="false" binarizeMultifurcations="true"
                              newick="(8:0.11314847358688301,((7:0.049633595857848656,(9:0.004882105343337117,1:0.004882105343337117)10:0.044751490514511535)11:0.012622152817484397,((2:0.010302113848007562,(5:0.0028753405860985205,6:0.0028753405860985205)12:0.007426773261909041)13:0.04015208286761772,(0:0.012283669670503974,(3:0.01187261131609086,4:0.01187261131609086)14:4.1105835441311404E-4)15:0.038170527045121305)16:0.011801551959707772)17:0.05089272491154996)18:0.0;">
                            <taxonset id="TaxonSet" spec="TaxonSet">
                                <taxon id="8" spec="Taxon"/>
                                <taxon id="7" spec="Taxon"/>
                                <taxon id="9" spec="Taxon"/>
                                <taxon id="1" spec="Taxon"/>
                                <taxon id="2" spec="Taxon"/>
                                <taxon id="5" spec="Taxon"/>
                                <taxon id="6" spec="Taxon"/>
                                <taxon id="0" spec="Taxon"/>
                                <taxon id="3" spec="Taxon"/>
                                <taxon id="4" spec="Taxon"/>
                            </taxonset>
                        </tree>
                    </daTreeModel>

                    <mu idref="mu"/>
                    <sigma idref="sigma"/>
                    <alpha idref="alpha"/>

                    <!-- <branchRateModel id="StrictClockModel" spec="beast.base.evolution.branchratemodel.StrictClockModel">-->
                    <!--     <parameter id="clock.rate" spec="parameter.RealParameter" name="clock.rate">1.0</parameter>-->
                    <!-- </branchRateModel>-->
                </distribution>

            </distribution> <!-- END Likelihood -->
        </distribution> <!-- END Posterior -->

        <operator id="lambda.scale" spec="kernel.BactrianScaleOperator" parameter="@lambda" upper="100.0" weight="1.0"/>

        <operator id="mu.randomWalk" spec="kernel.BactrianRandomWalkOperator" parameter="@mu" scaleFactor="0.1" weight="1.0"/>
        <operator id="sigma.randomWalk" spec="kernel.BactrianRandomWalkOperator" parameter="@sigma" scaleFactor="0.01" weight="2.0"/>
        <operator id="alpha.randomWalk" spec="kernel.BactrianRandomWalkOperator" parameter="@alpha" scaleFactor="0.05" weight="2.0"/>
        <!-- internal nodes angles WrappedRandomWalkOperator -->
        <!-- AVMN -->
        <!-- tree operators -->

        <logger id="tracelog" fileName="WBD_fixedtree.log" logEvery="1000" model="@posterior" sanitiseHeaders="true" sort="smart">
            <log idref="posterior"/>
            <log idref="likelihood"/>
            <log idref="prior"/>
            <log idref="lambda"/>
            <log idref="mu"/>
            <log idref="sigma"/>
            <log idref="alpha"/>
        </logger>

        <logger id="screenlog" logEvery="100000">
            <log idref="posterior"/>
            <log id="ESS.0" spec="util.ESS" arg="@posterior"/>
            <log idref="likelihood"/>
            <log idref="prior"/>
            <log idref="mu"/>
            <log idref="sigma"/>
            <log idref="alpha"/>
        </logger>

<!--        <logger id="treelog.t:firsthalf" fileName="WBD_fixedtree.trees" logEvery="1000" mode="tree">-->
<!--            <log id="TreeWithMetaDataLogger" spec="beast.base.evolution.tree.TreeWithMetaDataLogger" tree="@FixedTree"/>-->
<!--        </logger>-->

<!--        <logger id="internalNodesLog" fileName="WBD_fixedtree.log" logEvery="1000" mode="?">-->
<!--            <parameter idref="internalNodesAngles"/>-->
<!--        </logger>-->
    </run>
</beast>